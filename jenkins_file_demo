pipeline {
    agent  any  
 parameters {
        choice(name: 'ENV_PIPLINE', choices: ['build', 'deploy'])
    }
    stages {
        stage('build') {
            steps {
                echo 'build'
                script{
                    if (params.ENV_PIPLINE == "build") {
                             sh '''
                             docker build -t hossam23/demo:lts .
                             echo "Your Img.V:lts"
                             '''
                     }
                    else {
                        echo "user choosed ${BRANCH_NAME}"
                    }
                }
            }
        }
        stage('deploy') {
            steps {
                echo 'deploy'
                script {
                    if (params.ENV_PIPLINE == "deploy") {
                             sh '''
                             kubectl create namespace  ${BRANCH_NAME}

                            kubectl apply -f deploy.yaml   -n ${BRANCH_NAME}
                            kubectl apply -f service.yaml  -n ${BRANCH_NAME}
                            '''
                     }
                }
            }
        }
    }
}
